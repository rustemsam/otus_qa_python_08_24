# Домашнее задание: Анализ лога веб-сервера

**Цель:**
потренироваться писать парсеры для логов.

### Задание

Написать скрипт анализа приложенного access.log файла.

Формат записи в файле лога:
`%h %t "%r" %>s %b "%{Referer}i" "%{User-Agent}i" %D`

- `%h` - имя удаленного хоста
- `%t`  - время получения запроса
- `%r`  - тип запроса, его содержимое и версия
- `%s` - код состояния HTTP
- `%b` - количество отданных сервером байт
- `%{Referer}` - URL-источник запроса
- `%{User-Agent}` - HTTP-заголовок, содержащий информацию о запросе
- `%D` - длительность запроса в миллисекундах

### Требования к реализации

Должна быть возможность указать директорий где искать логи или конкретный файл
Должна быть возможность обработки всех логов внутри одного директория
Для лога должна собираться следующая информация:
общее количество выполненных запросов
количество запросов по HTTP-методам: GET, POST, PUT, DELETE, OPTIONS, HEAD. Например, GET - 20, POST - 10 и т.п.
топ 3 IP адресов, с которых было сделано наибольшее количество запросов
топ 3 самых долгих запросов - должны выводиться HTTP-метод, URL, IP, длительность запроса, дата и время запроса
Собранная статистика должна быть сохранена в json-файл и выведена в терминал в следующем формате
Если в процессе работы скрипта было проанализировано несколько лог-файлов, то для каждого из файлов должен быть
сформирован отдельный json-файл со статистикой и отдельный вывод в терминал
В репозитории должен присутствовать README.md файл, который описывает как работает скрипт

# Скрипт "Анализ лога веб-сервера"

### Скрипт анализа приложенного access.log файла, возможности:

1. Возможно указать директорий, где искать логи или конкретный файл
2. Вся статистика сохраняется в отдельном json-файле и выводится в терминал в удобном формате
3. Обработка всех логов внутри одного директория
4. Для `access.log` собирается следующая информация:
    - общее количество выполненных запросов (`total_requests`)
    - количество запросов по HTTP-методам (`total_stat`)
    - топ 3 IP адресcов, с которых были сделаны запросы (`top_ip_requests`)
    - топ 3 самых долгих запросов c полямии: метод, url, ip, длительность, дату и время запроса (`top_longest`)
5. Пример запуска скрипта `python log_parser.py -t access.tar`
6. Пример вывода:

```json
{
  "top_ips": {
    "193.106.31.130": 235209,
    "198.50.156.189": 167812,
    "5.112.235.245": 166722
  },
  "top_longest": [
    {
      "ip": "62.93.172.245",
      "date": "23/Dec/2015:07:27:57 +0100",
      "method": "POST",
      "url": "/administrator/index.php",
      "duration": 10000
    },
    {
      "ip": "213.162.68.113",
      "date": "06/Jan/2016:18:47:57 +0100",
      "method": "GET",
      "url": "/media/system/css/modal.css",
      "duration": 10000
    },
    {
      "ip": "194.166.55.43",
      "date": "06/Jan/2016:21:29:02 +0100",
      "method": "GET",
      "url": "/images/phocagallery/almhuette/thumbs/phoca_thumb_m_terasse.jpg",
      "duration": 10000
    }
  ],
  "total_stats": {
    "GET": 2247848,
    "POST": 918794,
    "HEAD": 49971,
    "PUT": 70,
    "OPTIONS": 39,
    "DELETE": 1
  },
  "total_requests": 3216723
}
```